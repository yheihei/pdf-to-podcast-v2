# PDF to Podcast Audio Generator 基本設計書

作成日: 2025年6月25日

## 1. システム概要

### 1.1 目的
PDF/テキストファイルからポッドキャスト風の音声ファイルを生成するPythonツール。長文コンテンツを音声化し、聞きやすい形式で提供することを目的とする。

### 1.2 主要機能
- PDF/テキストファイルからのテキスト抽出
- 長文テキストの適切な分割
- 口語調スクリプトへの変換
- 音声ファイル（MP3）の生成

## 2. アーキテクチャ

### 2.1 システム構成
```
pdf-to-podcast-v2/
├── src/
│   ├── cli.py              # CLIインターフェース
│   ├── phases/             # 各処理フェーズ
│   │   ├── input_phase.py      # 入力処理
│   │   ├── split_phase.py      # コンテンツ分割
│   │   ├── script_phase.py     # 脚本生成
│   │   └── synthesize_phase.py # 音声合成
│   └── utils/              # ユーティリティ
│       ├── config.py          # 設定管理
│       └── logger.py          # ログ管理
├── output/                 # 出力ディレクトリ
│   ├── chunks/            # 分割テキスト
│   ├── scripts/           # 生成脚本
│   └── audio/             # 音声ファイル
└── logs/                  # ログファイル
```

### 2.2 処理フロー
1. **入力フェーズ**: PDF/テキスト → 抽出テキスト
2. **分割フェーズ**: 抽出テキスト → チャンク分割
3. **脚本フェーズ**: チャンク → 口語調脚本
4. **音声フェーズ**: 脚本 → MP3音声

## 3. 各フェーズの詳細設計

### 3.1 入力フェーズ (InputPhase)
**目的**: PDFまたはテキストファイルからテキストを抽出

**主要機能**:
- PDF読み込み（ページ範囲指定可能）
- テキストファイル読み込み
- テキスト整形（改行処理、段落整理）

**使用ライブラリ**:
- pdfplumber: メインのPDF処理
- PyPDF2: フォールバック用

### 3.2 分割フェーズ (SplitPhase)
**目的**: 長文テキストを適切なサイズに分割

**主要機能**:
- 自然な区切りでの分割（LLM利用）
- 約2000文字（音声4分相当）を目安
- 短文の場合は分割なし

**処理方法**:
- Gemini APIを使用して論理的な分割位置を決定
- フォールバック: 段落単位での単純分割

### 3.3 脚本フェーズ (ScriptPhase)
**目的**: テキストを口語調の脚本に変換

**主要機能**:
- 話し言葉への変換
- スタイル指定（親しみやすく、落ち着いた等）
- 専門用語の簡潔な説明追加

**プロンプト設計**:
- 聞き手を意識した話し方
- 長文の分割による聞きやすさ向上
- 内容の忠実性を保持

### 3.4 音声合成フェーズ (SynthesizePhase)
**目的**: 脚本から音声ファイルを生成

**現在の実装**:
- Gemini APIの音声生成機能は未公開のため、プレースホルダー実装
- 1秒の無音MP3ファイルを生成
- メタデータに音声設定情報を記録

**将来の拡張性**:
- Google Cloud TTS
- Amazon Polly
- Azure Speech Services
との統合が可能な設計

## 4. 設定管理

### 4.1 環境変数 (.env)
```
GENAI_API_KEY       # Google Generative AI APIキー
MODEL_SPLIT         # 分割用モデル
MODEL_SCRIPT        # 脚本生成用モデル
MODEL_TTS          # 音声合成用モデル
VOICE_NAME         # 音声名
VOICE_STYLE        # 音声スタイル
```

### 4.2 CLI引数
- 各フェーズ個別実行
- 全フェーズ一括実行
- 出力ディレクトリ指定
- モデル/音声設定の上書き

## 5. エラーハンドリング

### 5.1 入力検証
- ファイル存在確認
- ページ範囲の妥当性確認
- API設定の検証

### 5.2 処理エラー
- API呼び出しエラー
- ファイルI/Oエラー
- 変換処理エラー

### 5.3 ログ出力
- INFO: 主要処理の開始/完了
- DEBUG: 詳細な処理情報
- ERROR: エラー情報とスタックトレース
- ローテーション機能付きファイル出力

## 6. テスト結果

### 6.1 動作確認済み機能
- ✅ テキストファイル入力
- ✅ コンテンツ分割（短文）
- ✅ 脚本生成（Gemini API）
- ✅ プレースホルダー音声生成
- ✅ 全フェーズ連携動作

### 6.2 制限事項
- 音声合成はプレースホルダー実装
- PDF処理は基本的なテキスト抽出のみ
- 画像や表の処理は未対応

## 7. 今後の拡張案

### 7.1 音声合成の実装
- 外部TTS APIの統合
- 複数話者対応
- BGM/効果音の追加

### 7.2 入力処理の強化
- 画像からのテキスト抽出（OCR）
- 表データの読み上げ対応
- Webページ入力対応

### 7.3 出力の改善
- 複数音声ファイルの自動結合
- チャプター情報の埋め込み
- 配信用メタデータの生成

## 8. 使用技術

### 8.1 言語・フレームワーク
- Python 3.10+
- Click (CLI framework)

### 8.2 主要ライブラリ
- google-generativeai: Gemini API
- pdfplumber/PyPDF2: PDF処理
- pydub: 音声処理
- python-dotenv: 環境設定

### 8.3 外部API
- Google Generative AI (Gemini)
  - gemini-2.5-flash-lite: 分割処理
  - gemini-2.5-pro: 脚本生成
  - gemini-2.5-pro-preview-tts: 音声合成（予定）